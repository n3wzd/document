---
categories:
- Redis
date: '2025-02-06'
title: '[Redis] 3. Persistence'
---

{% raw %}
Redis의 **지속성(Persistence)** 기능은 Redis가 메모리 기반의 데이터 저장소로 동작하는 것에 대한 해결책으로, 데이터를 디스크에 저장하여 Redis가 재시작되거나 종료되더라도 데이터를 복구할 수 있게 도와줍니다.

Redis는 두 가지 영속성 방법을 제공합니다. RDB는 빠른 복구와 성능에 유리하며, AOF는 최소 데이터 손실과 상세한 로그 기록을 제공합니다.

### RDB (Redis Database Snapshotting)
RDB는 스냅샷(snapshot)을 사용하여 Redis 데이터베이스의 상태를 주기적으로 디스크에 저장하는 방식입니다. Redis가 설정된 시간 간격에 맞춰 메모리 내 데이터를 덤프하여 디스크에 `dump.rdb` 파일로 저장합니다.

- **주기적 백업**: RDB는 설정된 조건을 만족할 때마다 Redis 데이터의 스냅샷을 찍어 저장합니다. 예를 들어, 900초마다 한 번, 10개의 수정이 있을 때마다 한 번씩 스냅샷을 찍을 수 있습니다.
- **장점**:
    - 성능이 뛰어납니다. Redis가 스냅샷을 찍을 때 Redis는 디스크에 데이터를 동기화하므로, 클라이언트 요청 처리에는 큰 영향을 미치지 않습니다.
    - **백업 용이**: RDB 파일 하나로 전체 데이터를 백업할 수 있습니다.
- **단점**:
    - **최신 데이터 손실**: 스냅샷이 마지막으로 찍힌 시점 이후에 발생한 데이터는 복구되지 않습니다. 예를 들어, 10분 간격으로 스냅샷을 찍으면 그 사이에 변경된 데이터는 손실될 수 있습니다.

**RDB 설정** (`redis.conf`):
```
# RDB 저장 설정
save 900 1     # 900초(15분) 동안 1개 이상의 키가 변경되면 스냅샷
save 300 10    # 300초(5분) 동안 10개 이상의 키가 변경되면 스냅샷
save 60 10000  # 60초 동안 10000개 이상의 키가 변경되면 스냅샷
```

### AOF (Append-Only File)
AOF는 Redis의 모든 쓰기 작업을 로그 파일에 추가적으로 기록하는 방식입니다. Redis는 write 명령이 실행될 때마다 해당 명령을 `appendonly.aof`라는 파일에 기록합니다. Redis 서버가 재시작되면 AOF 파일을 재생하여 데이터를 복구합니다.

- **모든 쓰기 작업 기록**: AOF는 Redis의 모든 쓰기 작업을 로그로 기록하므로, AOF 파일을 통해 모든 변경 사항을 추적할 수 있습니다.
- **장점**:
    - **최소 데이터 손실**: AOF는 다양한 동기화 정책을 설정할 수 있기 때문에, 최신 데이터가 손실될 위험을 최소화할 수 있습니다.
    - **AOF 파일 복구**: Redis가 종료된 후 AOF 파일을 사용해 데이터 복구가 가능합니다.
- **단점**:
    - **성능 저하**: AOF는 매번 디스크에 기록하므로 성능에 영향을 미칠 수 있습니다. 이를 해결하기 위해 동기화 빈도를 조정할 수 있습니다.
    - **파일 크기**: AOF 파일은 시간이 지남에 따라 커질 수 있으며, 이를 관리하려면 파일 압축이나 재작성 작업이 필요합니다.

**AOF 설정** (`redis.conf`):
```
# AOF 활성화
appendonly yes

# AOF 동기화 정책
appendfsync everysec  # 1초마다 AOF 파일 동기화
appendfsync always     # 매번 동기화 (성능 저하)
appendfsync no         # 동기화하지 않음 (위험함)
```
{% endraw %}