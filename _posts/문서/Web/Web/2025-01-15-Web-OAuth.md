---
categories:
- Web
date: '2025-01-15'
title: '[Web] OAuth'
---

{% raw %}
`OAuth(Open Authorization)`는 웹 및 모바일 애플리케이션을 위한 개방형 표준 인증 프로토콜입니다. OAuth는 보안을 강화하고 사용자의 리소스에 대한 제어를 사용자에게 부여함으로써 개인정보 보호를 강화하는 데 도움이 됩니다. 또한 OAuth를 통해 사용자가 여러 애플리케이션을 사용할 때마다 각 애플리케이션에 사용자 이름과 비밀번호를 제공하지 않고도 로그인할 수 있습니다.

일반적으로 OAuth는 다음과 같은 시나리오에서 사용됩니다:
- **사용자 인증**: 사용자는 애플리케이션에 로그인할 때 OAuth를 사용하여 자신의 신원을 확인합니다.
- **권한 부여**: 사용자는 애플리케이션이 특정 리소스(예: 프로필 정보, 연락처, 이미지 등)에 액세스할 수 있는 권한을 부여합니다.
- **액세스 토큰 발급**: 인증 서버는 사용자의 동의를 받은 후, 애플리케이션에 대한 액세스 토큰을 발급합니다.
- **액세스 토큰을 사용한 리소스 액세스**: 애플리케이션은 발급받은 액세스 토큰을 사용하여 사용자의 리소스에 액세스하고 작업을 수행합니다.

### 액세스 토큰
`액세스 토큰(Access Token)`은 사용자의 인증 상태를 나타내는 문자열입니다. 사용자가 성공적으로 인증되면 인증 서버에서 액세스 토큰이 발급됩니다. 이 토큰은 보통 짧은 기간(일반적으로 몇 시간) 동안 유효하며, 애플리케이션이 특정 API를 사용하거나 사용자의 리소스에 대한 작업을 수행하는 데 사용됩니다. 액세스 토큰을 통해 인증된 사용자에게만 특정 리소스에 대한 액세스 권한이 부여됩니다.

### 리프레시 토큰
`리프레시 토큰(Refresh Token)`은 액세스 토큰의 갱신을 위해 사용됩니다. 일반적으로 액세스 토큰은 유효 기간이 짧기 때문에, 유효 기간이 만료되면 새로운 액세스 토큰을 얻기 위해 리프레시 토큰이 사용됩니다. 리프레시 토큰은 일반적으로 긴 유효 기간을 가지며, 리프레시 토큰을 사용하여 액세스 토큰을 갱신하면, 사용자는 로그인 상태를 유지한 채로 애플리케이션을 계속 사용할 수 있습니다. 리프레시 포튼은 보안적인 이유로 사용자의 기기에 저장되어야 합니다.

### JWT
JWT(JSON Web Token)는 JSON 포맷을 사용하여 정보를 안전하게 표현하고 전송하기 위한 개방형 표준(RFC 7519)입니다. JWT는 주로 인증 및 권한 부여 목적으로 사용되며, 액세스 토큰으로 자주 활용됩니다.

**장점**
- **확장성**: 상태 비저장이므로 서버 확장이 쉽습니다.
- **보안**: 서명으로 무결성을 보장합니다.
- **효율성**: 페이로드에 필요한 정보를 포함하므로 추가 조회가 필요 없습니다.

**단점**
- **크기**: JWT는 자체적으로 정보를 포함하므로 크기가 클 수 있습니다.
- **무효화 어려움**: 한 번 발급된 JWT는 만료 전까지 무효화하기 어렵습니다.
- **보안 위험**: 서명이 유출되면 토큰이 위조될 위험이 있습니다.

JWT는 세 부분으로 구성된 문자열입니다. 세 부분을 `Base64Url`로 인코딩한 뒤, 점(`.`)으로 연결하여 최종 JWT가 만들어집니다.

#### Header
JWT의 타입과 서명 알고리즘 정보를 포함합니다.
- `alg`: 서명에 사용된 알고리즘 (예: `HS256`, `RS256`)
- `typ`: 토큰의 타입 (일반적으로 `JWT`)

```
{
  "alg": "HS256",
  "typ": "JWT"
}
```

#### Payload (페이로드)
사용자 정보 및 클레임(Claims)을 담고 있는 부분입니다. 클레임은 JWT에서 데이터를 표현하는 방식이며, 크게 세 가지로 나뉩니다:
1. **등록된 클레임 (Registered Claims)**:
    - 사전에 정의된 표준 클레임.
    - 예: `iss` (발급자), `sub` (주제), `aud` (대상), `exp` (만료 시간), `iat` (발급 시간).
2. **공개 클레임 (Public Claims)**:
    - 사용자 정의 데이터.
    - 예: 사용자 이름, 이메일 등.
3. **비공개 클레임 (Private Claims)**:
    - 발급자와 소비자 간에 정의된 데이터.

```
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true,
  "exp": 1672531200
}
```

#### Signature (서명)
JWT의 무결성을 보장하는 부분입니다. 헤더와 페이로드를 합친 후 비밀 키를 사용하여 서명을 생성합니다.
    
서명 생성 방식:
```
HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload),
  secret
)
```

### 세션 vs JWT
|특징|세션|JWT|
|---|---|---| 
|**상태 관리**|서버에서 상태 저장|클라이언트가 상태 정보 포함|
|**확장성**|서버 부담 증가|서버 부담 적음, 분산 시스템 적합|
|**보안**|세션 ID 보호 필요|서명으로 위조 방지, 민감 정보 주의|
|**유효성 관리**|서버에서 세션 만료 처리 가능|토큰 만료 전까지 유효|
|**사용 사례**|전통적인 웹 애플리케이션|RESTful API, 모바일/분산 환경|

#### 세션을 사용하는 것이 적합한 경우
1. **상태를 서버에서 관리해야 하는 경우**:
    - 서버에서 세션을 관리하고, 유효성을 제어하기 쉬운 구조가 필요할 때.
    - 예: 전통적인 웹 애플리케이션, 서버에서 사용자 상태를 자주 업데이트하거나 확인해야 하는 경우.
2. **보안이 중요한 경우**:
    - 세션은 서버에서 상태를 관리하므로, 민감한 정보를 클라이언트에 노출하지 않습니다.
    - 예: 민감한 금융 서비스나 내부 애플리케이션.
3. **사용자 수가 적거나 서버 확장이 필요하지 않은 경우**:
    - 서버가 충분한 리소스를 가지고 있고, 세션 저장소 관리가 간단한 경우.

#### JWT를 사용하는 것이 적합한 경우
1. **확장성과 분산 시스템이 중요한 경우**:
    - JWT는 클라이언트에 상태를 저장하므로, 서버 간 상태 동기화가 필요하지 않습니다.
    - 예: 마이크로서비스 아키텍처, 서버리스 환경, 글로벌 사용자 기반.
2. **RESTful API 또는 모바일 환경**:
    - 클라이언트가 API를 호출할 때마다 상태를 서버에 저장하지 않고도 인증을 유지할 수 있습니다.
    - 예: 모바일 앱, SPA(Single Page Application).
3. **서버 부담을 줄이고 싶을 때**:
    - 세션 저장소를 유지하지 않아도 되므로 서버 리소스가 절약됩니다.
4. **토큰 기반 인증이 필요한 경우**:
    - JWT는 자체적으로 인증 정보를 포함하므로, 외부 인증 시스템과 통합하기 쉽습니다.
{% endraw %}